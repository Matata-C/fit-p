# 微信運動授權步數功能說明

## 功能概述
首頁的今日步數卡片現在通過微信運動授權來獲取步數數據：
- 當用戶點擊"允許"時，獲取微信運動步數數據
- 當用戶點擊"拒絕"時，顯示"當前用戶未授權"

## 實現方式

### 數據獲取流程
1. **檢查權限**：檢查是否已授權微信運動權限
2. **請求授權**：如果未授權，彈出授權請求
3. **處理結果**：
   - 允許：獲取微信運動數據並顯示
   - 拒絕：顯示"當前用戶未授權"
4. **手動刷新**：長按步數卡片可重新請求授權

### 權限處理邏輯
```javascript
wx.getSetting() → 檢查權限 → 
├─ 已授權 → 獲取數據
└─ 未授權 → wx.authorize() → 
   ├─ 成功 → 獲取數據
   └─ 失敗 → 顯示"當前用戶未授權"
```

## 功能特點

### 智能權限處理
- 自動檢查權限狀態
- 首次使用時彈出授權請求
- 拒絕授權時顯示友好提示

### 數據顯示
- **授權成功**：顯示實際步數（目前使用模擬數據）
- **授權失敗**：顯示"當前用戶未授權"
- **樣式區分**：未授權狀態使用不同字體大小和顏色

### 手動刷新
- 長按步數卡片可手動刷新
- 重新觸發授權流程
- 顯示加載提示

## 技術實現

### 核心方法
- `getWeRunSteps()`：檢查權限並獲取數據
- `fetchWeRunSteps()`：實際調用微信API
- `refreshStepData()`：手動刷新功能

### 配置要求
在 `app.json` 中添加了微信運動權限：
```json
{
  "permission": {
    "scope.werun": {
      "desc": "用於獲取您的運動步數數據，幫助您更好地記錄健康狀況"
    }
  }
}
```

## 使用方法

### 用戶操作
1. **首次使用**：進入首頁會自動彈出授權請求
2. **允許授權**：點擊"允許"查看步數數據
3. **拒絕授權**：點擊"拒絕"顯示未授權提示
4. **重新授權**：長按步數卡片可重新請求授權

### 顯示效果
- **正常狀態**：大號黃色數字顯示步數
- **未授權狀態**：小號粉色文字顯示"當前用戶未授權"

## 注意事項

1. **模擬數據**：目前使用隨機模擬數據，實際項目中需要服務端解密
2. **權限持久化**：授權狀態會被記住，除非用戶手動取消
3. **數據延遲**：微信運動數據通常有1-2小時延遲
4. **重新授權**：用戶可以在設置中手動開啟或關閉權限

## 更新內容

### 修改的文件
1. **`pages/index/index.js`**：
   - 重構了 `loadTodaySteps` 方法
   - 添加了微信運動授權邏輯
   - 實現了手動刷新功能

2. **`pages/index/index.wxml`**：
   - 將步數卡片的長按事件改為刷新功能
   - 添加了條件樣式類

3. **`pages/index/index.wxss`**：
   - 添加了未授權狀態的樣式

4. **`app.json`**：
   - 添加了微信運動權限配置

### 新增功能
- 微信運動授權獲取步數
- 智能權限處理
- 未授權狀態顯示
- 手動刷新功能
- 條件樣式支持 