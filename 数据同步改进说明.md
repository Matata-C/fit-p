# 步数数据同步改进说明

## 问题描述
首页和分析页的步数数据存在不同步的问题，导致用户在不同页面看到不同的步数数据。

## 改进方案

### 1. 统一数据获取入口
- 新增 `getTodaySteps()` 函数作为步数数据的唯一获取入口
- 确保首页和分析页使用相同的数据源和逻辑

### 2. 数据优先级策略
1. **微信运动数据** - 最高优先级，实时获取
2. **运动记录数据** - 次优先级，从本地运动记录获取
3. **本地存储数据** - 最低优先级，作为备用数据源

### 3. 自动同步机制
- 首页获取新步数后，设置 `dataUpdated` 标志
- 分析页检测到数据更新后，自动刷新步数显示
- 每次页面显示时都检查数据同步状态

### 4. 调试功能
- 新增 `getDataSyncStatus()` 函数，可查看各数据源状态
- 首页长按步数卡片可显示调试按钮
- 点击调试按钮可查看详细的数据同步状态

## 技术实现

### 核心函数
```javascript
// 统一步数获取函数
getTodaySteps()

// 数据同步状态监控
getDataSyncStatus()

// 步数数据同步检查
checkStepsSynchronization()
```

### 数据流程
1. 用户授权微信运动 → 获取步数 → 存储到 `stepCount`
2. 设置 `dataUpdated` 标志 → 通知其他页面
3. 其他页面检测到标志 → 调用 `getTodaySteps()` 获取最新数据
4. 更新页面显示 → 确保数据一致性

## 使用方法

### 开发者调试
1. 长按首页步数卡片
2. 点击出现的调试按钮（🔍）
3. 查看数据同步状态详情

### 用户使用
- 无需额外操作，数据自动同步
- 在不同页面间切换时，步数数据保持一致

## 注意事项

1. **数据一致性**：确保所有页面使用 `dataSync.getTodaySteps()` 获取步数
2. **更新时机**：在 `onShow` 生命周期中调用同步检查
3. **错误处理**：各数据源获取失败时，自动降级到下一优先级
4. **性能优化**：避免频繁调用，使用标志位控制更新频率

## 测试建议

1. 测试微信运动授权流程
2. 验证首页和分析页数据同步
3. 检查数据源优先级是否正确
4. 测试网络异常情况下的降级处理
5. 验证调试功能的可用性

## 后续优化

1. 添加数据同步日志记录
2. 实现数据冲突检测和解决
3. 优化同步性能，减少不必要的更新
4. 添加用户手动同步功能
